# 5-2 Create Dockerfile for Slackbot application

[Back to task list](./tasks.md)

## Description

Create a Dockerfile that properly containerizes the Slackbot application with all dependencies, configuration, and health checks. The Dockerfile should follow best practices for Python applications and be optimized for the PA ecosystem.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-01-20 19:50:00 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2025-01-20 19:50:00 | Status Change | Proposed | Agreed | Task approved and ready for implementation | AI_Agent |
| 2025-01-20 19:50:00 | Status Change | Agreed | InProgress | Started Dockerfile creation | AI_Agent |
| 2025-01-20 20:30:00 | Status Change | InProgress | Review | Dockerfile created and tested successfully | AI_Agent |

## Requirements

### Functional Requirements
1. **Python Environment**: Use Python 3.11-slim base image
2. **Dependencies**: Install all requirements from requirements.txt
3. **Application Files**: Copy Slackbot source code
4. **Working Directory**: Set proper working directory
5. **Entry Point**: Configure proper application startup
6. **Health Check**: Implement HTTP health check endpoint

### Technical Requirements
1. **Multi-stage Build**: Optimize image size if beneficial
2. **Security**: Run as non-root user
3. **Logging**: Configure proper logging output
4. **Environment Variables**: Support all required environment variables
5. **Port Configuration**: Expose port 8081 for MCP interface
6. **State Persistence**: Support volume mounts for state storage

## Implementation Plan

### Phase 1: Basic Dockerfile Structure
1. Choose appropriate base image (Python 3.11-slim)
2. Set up working directory
3. Install system dependencies if needed
4. Copy requirements and install Python packages

### Phase 2: Application Configuration
1. Copy application source code
2. Set proper file permissions
3. Configure non-root user
4. Set working directory and entry point

### Phase 3: Health Check Implementation
1. Create health check script
2. Configure Docker health check
3. Test health check functionality

### Phase 4: Optimization
1. Review image size
2. Optimize layer caching
3. Ensure security best practices

## Verification

### Success Criteria
- [ ] Dockerfile builds successfully
- [ ] Container starts and runs Slackbot application
- [ ] Health check endpoint responds correctly
- [ ] All environment variables are supported
- [ ] Application connects to Slack and Letta
- [ ] State persistence works with volume mounts
- [ ] Container follows security best practices

### Test Commands
```bash
# Build the image
docker build -t slackbot-mcp .

# Run the container
docker run -d --name slackbot-test \
  -e SLACK_BOT_TOKEN=test \
  -e SLACK_APP_TOKEN=test \
  -e LETTA_BASE_URL=http://letta:8283 \
  -e LETTA_AGENT_ID=test \
  -p 8081:8081 \
  slackbot-mcp

# Test health check
curl -f http://localhost:8081/health

# Check logs
docker logs slackbot-test
```

## Files Modified

- `slackbot/Dockerfile` (to be created)
- `slackbot/health_check.py` (to be created)
- `docs/delivery/5/5-2.md` (this file)
