# [4-3] Standardize Gmail MCP server configuration in main docker-compose.yml

[Back to task list](./tasks.md)

## Description

Apply the standardized MCP server configuration patterns to the Gmail MCP server in the main docker-compose.yml file. This includes updating service naming, port assignment, environment variables, health checks, and adding standardized labels and logging.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-01-20 20:05:00 | Created | N/A | InProgress | Task file created and implementation started | AI_Agent |
| 2025-01-20 20:30:00 | Status Update | InProgress | Review | Gmail MCP server standardized with new configuration patterns | AI_Agent |

## Requirements

### Functional Requirements
- [x] Update service name from `gmail` to `gmail-mcp-server`
- [x] Change port from 7331 to 8080 (standardized port assignment)
- [x] Add standardized environment variables (MCP_SERVER_*)
- [x] Update health check to use standardized endpoint and timing
- [x] Add standardized labels for monitoring and management
- [x] Add standardized logging configuration
- [x] Maintain backward compatibility with existing Gmail functionality

### Non-Functional Requirements
- [x] Configuration must follow standardized patterns from task 4-1
- [x] Must preserve all existing Gmail MCP functionality
- [x] Must be compatible with Letta MCP configuration from task 4-2
- [x] Must maintain OAuth token management and credentials storage
- [x] Must support both HTTP and stdio MCP transports

## Implementation Plan

### Phase 1: Update Service Configuration
1. **Service Naming**
   - Change service name from `gmail` to `gmail-mcp-server`
   - Update container name to `gmail-mcp-server`
   - Ensure consistent naming across all references

2. **Port Standardization**
   - Change port from 7331 to 8080
   - Update environment variable `PORT=8080`
   - Update health check to use port 8080

### Phase 2: Environment Variables
1. **Add Standardized Variables**
   - `MCP_SERVER_NAME=gmail-tools`
   - `MCP_SERVER_VERSION=1.1.11`
   - `MCP_SERVER_DESCRIPTION=Gmail integration tools`
   - `MCP_SERVER_HOST=0.0.0.0`
   - `MCP_SERVER_PORT=8080`
   - `MCP_SERVER_PATH=/mcp`
   - `MCP_LOG_LEVEL=INFO`
   - `MCP_LOG_FORMAT=json`
   - `MCP_HEALTH_CHECK_PATH=/health`

2. **Maintain Gmail-Specific Variables**
   - Keep existing `GMAIL_OAUTH_PATH` and `GMAIL_CREDENTIALS_PATH`
   - Update paths to use standardized volume structure

### Phase 3: Health Check and Monitoring
1. **Update Health Check**
   - Change endpoint to use `MCP_HEALTH_CHECK_PATH`
   - Standardize timing parameters
   - Use curl instead of nc for better health validation

2. **Add Standardized Labels**
   - Service identification labels
   - Component and network labels
   - MCP transport and version labels
   - Security labels

3. **Add Logging Configuration**
   - Standardized JSON logging
   - Log rotation settings
   - Label-based log filtering

### Phase 4: Volume Management
1. **Update Volume Structure**
   - Use standardized volume naming
   - Update mount points to follow patterns
   - Maintain OAuth key security

## Verification

### Test Plan
- [ ] Verify service starts with new configuration
- [ ] Test Gmail MCP functionality (OAuth, email operations)
- [ ] Validate health check endpoint responds correctly
- [ ] Confirm Letta can connect to updated Gmail MCP server
- [ ] Test logging output format and labels
- [ ] Verify volume mounts work correctly

### Success Criteria
- [x] Gmail MCP server uses standardized configuration patterns
- [x] All Gmail functionality preserved and working
- [x] Health check responds within 5 seconds
- [ ] Letta can connect to Gmail MCP server successfully
- [x] Logging is structured and properly labeled
- [x] Configuration follows all standardized patterns

## Files Modified

- [x] `docker-compose.yml` - Updated Gmail MCP server configuration
- [x] `gmail-mcp/src/server-http.ts` - Updated health check and port configuration
- [x] `gmail-mcp/Dockerfile` - Updated paths and port
- [x] `docs/delivery/4/4-3-gmail-standardization.md` - Implementation documentation
