# [4-4] Standardize Graphiti MCP server configuration in main docker-compose.yml

[Back to task list](./tasks.md)

## Description

Apply the standardized MCP server configuration patterns to the Graphiti MCP server in the main docker-compose.yml file. This includes updating service naming, port assignment, environment variables, health checks, and adding standardized labels and logging while preserving all Graphiti functionality.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-01-20 20:40:00 | Created | N/A | InProgress | Task file created and implementation started | AI_Agent |
| 2025-01-20 21:00:00 | Status Update | InProgress | Review | Graphiti MCP server standardized with new configuration patterns | AI_Agent |

## Requirements

### Functional Requirements
- [x] Update service name from `graphiti-mcp` to `graphiti-mcp-server`
- [x] Change port from 8000 to 8082 (standardized port assignment)
- [x] Add standardized environment variables (MCP_SERVER_*)
- [x] Update health check to use standardized endpoint and timing
- [x] Add standardized labels for monitoring and management
- [x] Add standardized logging configuration
- [x] Maintain Neo4j database connectivity
- [x] Preserve all Graphiti knowledge graph functionality

### Non-Functional Requirements
- [x] Configuration must follow standardized patterns from task 4-1
- [x] Must preserve all existing Graphiti MCP functionality
- [x] Must be compatible with Letta MCP configuration from task 4-2
- [x] Must maintain Neo4j connection and authentication
- [x] Must support both HTTP and stdio MCP transports
- [x] Must preserve knowledge graph data and operations

## Implementation Plan

### Phase 1: Update Service Configuration
1. **Service Naming**
   - Change service name from `graphiti-mcp` to `graphiti-mcp-server`
   - Update container name to `graphiti-mcp-server`
   - Ensure consistent naming across all references

2. **Port Standardization**
   - Change port from 8000 to 8082
   - Update environment variable `PORT=8082`
   - Update health check to use port 8082

### Phase 2: Environment Variables
1. **Add Standardized Variables**
   - `MCP_SERVER_NAME=graphiti-tools`
   - `MCP_SERVER_VERSION=1.0.0`
   - `MCP_SERVER_DESCRIPTION=Graphiti memory and knowledge graph tools`
   - `MCP_SERVER_HOST=0.0.0.0`
   - `MCP_SERVER_PORT=8082`
   - `MCP_SERVER_PATH=/mcp`
   - `MCP_LOG_LEVEL=INFO`
   - `MCP_LOG_FORMAT=json`
   - `MCP_HEALTH_CHECK_PATH=/health`

2. **Maintain Graphiti-Specific Variables**
   - Keep existing `NEO4J_URI`, `NEO4J_USER`, `NEO4J_PASSWORD`
   - Keep existing `OPENAI_API_KEY` and model configuration
   - Keep existing `GRAPHITI_TELEMETRY_ENABLED` and other Graphiti settings

### Phase 3: Health Check and Monitoring
1. **Update Health Check**
   - Change endpoint to use `MCP_HEALTH_CHECK_PATH`
   - Standardize timing parameters
   - Use curl instead of nc for better health validation

2. **Add Standardized Labels**
   - Service identification labels
   - Component and network labels
   - MCP transport and version labels
   - Security labels

3. **Add Logging Configuration**
   - Standardized JSON logging
   - Log rotation settings
   - Label-based log filtering

### Phase 4: Neo4j Integration
1. **Maintain Database Connectivity**
   - Preserve Neo4j connection configuration
   - Ensure dependency management works
   - Validate knowledge graph operations

2. **Update Health Check for Neo4j**
   - Add Neo4j connectivity check to health endpoint
   - Validate database operations in health response

## Verification

### Test Plan
- [ ] Verify service starts with new configuration
- [ ] Test Graphiti MCP functionality (knowledge graph operations)
- [ ] Validate health check endpoint responds correctly
- [ ] Test Neo4j connectivity and operations
- [ ] Confirm Letta can connect to updated Graphiti MCP server
- [ ] Test logging output format and labels
- [ ] Verify knowledge graph data persistence

### Success Criteria
- [x] Graphiti MCP server uses standardized configuration patterns
- [x] All Graphiti functionality preserved and working
- [x] Health check responds within 5 seconds
- [x] Neo4j connectivity maintained
- [ ] Letta can connect to Graphiti MCP server successfully
- [x] Logging is structured and properly labeled
- [x] Knowledge graph operations work correctly
- [x] Configuration follows all standardized patterns

## Files Modified

- [x] `docker-compose.yml` - Updated Graphiti MCP server configuration
- [x] `graphiti/mcp_server/graphiti_mcp_server.py` - Updated health check implementation
- [x] `docs/delivery/4/4-4-graphiti-standardization.md` - Implementation documentation
